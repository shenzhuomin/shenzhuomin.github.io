<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>中国研究生人工智能创新大赛参赛统计</title>
    <script src="echarts.js"></script>
    <script src="./lib/jquery.js"></script>
    <script src="./lib/papaparse.js"></script>
    <script src="./lib/jschardet.js"></script>
    <!--[if lte IE 9]>
        <script src="./lib/base64.js"></script>
    <![endif]-->
    
    <script src="csv2arr.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="top">
        <div class="select-file">
            <div class="wrap">选择noin
                <input type="file" name="csvfile1" />
            </div>
        </div>
        <div class="select-file">
            <div class="wrap">选择school_team
                <input type="file" name="csvfile2" />
            </div>
        </div>
        <div class="select-file">
            <div class="wrap">选择total
                <input type="file" name="csvfile3" />
            </div>
        </div>
        <input type="button" onclick="csv3()" value="生成简报"/>
    </div>

    <div id="main">
        <div class="title">
            <h1>参赛队伍统计简报</h1>
            <p id="date"></p>
        </div>
        <div class="part2">
            <p id="summary"></p>
        </div>
        <div>
            <h2>高校覆盖率</h2>
            <div id="table1"></div>
        </div>
        <!-- 饼图 -->
        <div id="container" style="height: 550px; width: 600px"></div>
        <div>
            <h2>高校参赛情况</h2>
            <div id="table2"></div>
        </div>
        <div>
            <h2>未报名知名院校</h2>
            <div id="table3"></div>
        </div>
    </div>
    
    
    <script>
        var boshi_num;
        var shuoshi_num;
        var benke_num;
        function paintTable3 () {
            $("input[name=csvfile1]").csv2arr(function(arr){
                var flag = true; // 是否第一行
                var table3Str = "<table>";
                $.each( arr, function(i, line){
                    if( i === 0 ) {
                        table3Str += "<thead><tr>";
                    }else {
                        table3Str += "<tr>";
                    }
                    $.each( line, function(i, cell){
                        if( flag === true) {
                            table3Str += "<th>"+cell+"</th>";
                        }else {
                            table3Str += "<td>"+cell+"</td>";
                        }
                    });
                    flag = false;
                    if( i === 0) {
                        table3Str +="</tr></thead>"
                    }else {
                        table3Str += "</tr>";
                    }
                });
                $("#table3").html( table3Str );
            });
        }
        function paintTable2 () {
            $("input[name=csvfile2]").csv2arr(function(arr){
                var flag = true; // 是否第一行
                var table2Str = "<table>";
                $.each( arr, function(i, line){
                    if( i === 0 ) {
                        table2Str += "<thead><tr>";
                    }else {
                        table2Str += "<tr>";
                    }
                    $.each( line, function(i, cell){
                        if( flag === true) {
                            table2Str += "<th>"+cell+"</th>";
                        }else {
                            table2Str += "<td>"+cell+"</td>";
                        }
                    });
                    flag = false;
                    if( i === 0) {
                        table2Str +="</tr></thead>"
                    }else {
                        table2Str += "</tr>";
                    }
                });
                $("#table2").html( table2Str );
                paintTable3();
            });
        }
        function csv3(){
            $("input[name=csvfile3]").csv2arr(function(arr){
                var start;
                var num;
                // 获得日期
                var today = new Date();
                var year = today.getFullYear();
                var month = today.getMonth()+1;
                var day = today.getDate();
                today = year + '/' + month + '/' + day;
                document.getElementById("date").innerHTML = today;

                // 更改标题
                document.title = "中国研究生人工智能创新大赛参赛统计" + month + day;
                // 摘要
                // 学校总数
                start = arr[0][0].indexOf("：");
                num = arr[0][0].slice(start+1);
                var school_num = num;
                // 队伍总数
                start = arr[2][0].indexOf("：");
                num = arr[2][0].slice(start+1);
                var team_num = num;
                // 新增学校
                start = arr[1][0].indexOf("：");
                num = arr[1][0].slice(start+1);
                var new_school = num;
                // 新增队伍
                start = arr[3][0].indexOf("：");
                num = arr[3][0].slice(start+1);
                var new_team = num;
                var all = "截至"+month+"月"+day+"日15时：共"+school_num+"所高校，"+team_num+"个队伍报名，当日新增"+new_school+"个高校，"+new_team+"个队伍。";
                document.getElementById("summary").innerHTML = all;

                // 高校覆盖率
                // C9覆盖率
                var C9_rate;
                start = arr[11][0].indexOf("：");
                C9_rate = arr[11][0].slice(start+1);
                C9_rate = parseFloat(C9_rate);
                C9_rate = (C9_rate*100).toFixed(2) + '%';
                // 双一流覆盖率
                var syl_rate;
                start = arr[10][0].indexOf("：");
                syl_rate = arr[10][0].slice(start+1);
                syl_rate = parseFloat(syl_rate);
                syl_rate = (syl_rate*100).toFixed(2) + '%';
                // 985覆盖率
                var _985_rate;
                start = arr[8][0].indexOf("：");
                _985_rate = arr[8][0].slice(start+1);
                _985_rate = parseFloat(_985_rate);
                _985_rate = (_985_rate*100).toFixed(2) + '%';
                // 211覆盖率
                var _211_rate;
                start = arr[9][0].indexOf("：");
                _211_rate = arr[9][0].slice(start+1);
                _211_rate = parseFloat(_211_rate);
                _211_rate = (_211_rate*100).toFixed(2) + '%';

                var table1Str = '<table>'+
                '<thead><tr><th>高校</th><th>覆盖率</th><tr/></thead>'+
                '<tr><td>“C9”</td><td>'+C9_rate+'</td></tr>'+
                '<tr><td>“双一流”</td><td>'+syl_rate+'</td></tr>'+
                '<tr><td>“985”</td><td>'+_985_rate+'</td></tr>'+
                '<tr><td>“211”</td><td>'+_211_rate+'</td></tr>'+
                '</table>';
                document.getElementById("table1").innerHTML = table1Str;
                // 博士数量
                start = arr[15][0].indexOf("：");
                num = arr[15][0].slice(start+1);
                boshi_num = num;
                // 硕士数量
                start = arr[14][0].indexOf("：");
                num = arr[14][0].slice(start+1);
                shuoshi_num = num;
                // 本科数量
                start = arr[13][0].indexOf("：");
                num = arr[13][0].slice(start+1);
                benke_num = num;

                //something to do here
                var tblStr = "<table border='1'>";
                $.each( arr, function(i, line){
                    tblStr += "<tr>";
                    $.each( line, function(i, cell){
                        tblStr += "<td>"+cell+"</td>";
                    });
                    tblStr += "</tr>";
                });
                $("#resTbl").html( tblStr );

                // 画图
                paintBing();
                //画表
                paintTable2();
            });
            // paintTable3();
            var selectDom1 = document.getElementById("top");
            selectDom1.style.display = "none";
            var main = document.getElementById("main");
            main.style.display = "block";
        }
        function paintBing () {
            var dom = document.getElementById("container");
            var myChart = echarts.init(dom);
            var app = {};
            option = null;


            option = {
                title: {
                    text: '参赛队伍学历分布',
                    // subtext: '虚构数据',
                    left: 'center',
                    textStyle: {
                        fontSize: 24,
                        color: '#000'
                    },
                    top: 20
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    // orient: 'vertical',
                    // top: 'middle',
                    bottom: 20,
                    left: 'center',
                    data: ['博士','硕士','本科（已获研究生入学资格）'],
                    textStyle: {
                        fontSize: 18
                    }
                },
                // color:["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],
                color: ['#afe39b','#60acfc','#feb64d','#fa816d'],
                series : [
                    {
                        type: 'pie',
                        radius : '65%',
                        center: ['50%', '50%'],
                        selectedMode: 'single',
                        data:[
                            {value:boshi_num, name: '博士'},
                            {value:shuoshi_num, name: '硕士'},
                            {value:benke_num, name: '本科（已获研究生入学资格）'}
                        ],
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            },
                            normal: {
                                label:{
                                    show: true,
                                    // formatter: '{d}%',
                                    formatter:function(data){ return data.percent.toFixed(2)+"%";},
                                    fontSize: 18
                                },
                                labelLine :{show:true} 
                            }
                        }
                    }
                ]
            };
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }
        } 
    </script>
</body>
</html>